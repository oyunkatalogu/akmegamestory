<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
</head>
<body>
  <h1>Admin Panel</h1>

  <h2>Cihaz Ekle</h2>
  <input type="text" id="deviceName" placeholder="Yeni cihaz ismi">
  <button onclick="addDevice()">Cihaz Ekle</button>

  <h2>Oyun Ekle</h2>
  <select id="gameDevice"></select>
  <input type="text" id="gameName" placeholder="Oyun adı">
  <input type="text" id="gameCode" placeholder="Oyun kodu">
  <input type="text" id="gamePrice" placeholder="Fiyat">
  <input type="file" id="gameImage">
  <input type="file" id="gameVideo">
  <button onclick="uploadGame()">Yükle</button>

  <!-- Firebase kodları -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBb1dqb3SqYpkEtB3Wnt8LSVc41TSGETe4",
      authDomain: "akmegamestore-66522.firebaseapp.com",
      databaseURL: "https://akmegamestore-66522-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "akmegamestore-66522",
      storageBucket: "akmegamestore-66522.appspot.com",
      messagingSenderId: "893039272243",
      appId: "1:893039272243:web:c1b862e113b1e1a9528023"
    };

    firebase.initializeApp(firebaseConfig);

    // Cihaz listesi yükle
    firebase.database().ref('devices').on('value', snap => {
      const sel = document.getElementById('gameDevice');
      sel.innerHTML = '';
      snap.forEach(child => {
        const opt = document.createElement('option');
        opt.value = child.key;
        opt.textContent = child.val().name || child.key;
        sel.appendChild(opt);
      });
    });

    function addDevice() {
      const name = document.getElementById('deviceName').value.trim();
      if (!name) return alert("Cihaz adı girin!");
      firebase.database().ref('devices/' + name).set({ name }).then(() => {
        alert("Cihaz eklendi!");
        document.getElementById('deviceName').value = '';
      });
    }

    function uploadGame() {
      const name = document.getElementById('gameName').value;
      const code = document.getElementById('gameCode').value;
      const price = document.getElementById('gamePrice').value;
      const device = document.getElementById('gameDevice').value;
      const imageFile = document.getElementById('gameImage').files[0];
      const videoFile = document.getElementById('gameVideo').files[0];

      if (!name || !code || !price || !device || !imageFile || !videoFile) {
        alert("Lütfen tüm alanları doldurun.");
        return;
      }

      const storageRef = firebase.storage().ref();
      const imgRef = storageRef.child('images/' + imageFile.name);
      const vidRef = storageRef.child('videos/' + videoFile.name);

      Promise.all([
        imgRef.put(imageFile).then(() => imgRef.getDownloadURL()),
        vidRef.put(videoFile).then(() => vidRef.getDownloadURL())
      ]).then(([imgURL, vidURL]) => {
        const gameData = { name, code, price, device, image: imgURL, video: vidURL };
        firebase.database().ref('games/' + code).set(gameData).then(() => {
          alert("Oyun başarıyla eklendi!");
        });
      }).catch(err => {
        console.error(err);
        alert("Yükleme hatası: " + err.message);
      });
    }
  </script>
</body>
</html>