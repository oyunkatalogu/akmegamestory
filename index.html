<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AKME GAME - Sepetli Sistem</title>
  <style>
    body {
      background: linear-gradient(to right, #1f1f2f, #12121a);
      font-family: 'Segoe UI', sans-serif;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
    }
    .container {
      background-color: #2a2a3a;
      padding: 20px;
      border-radius: 10px;
      width: 320px;
      margin: 20px 0;
    }
    input, button, select {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border: none;
      border-radius: 5px;
    }
    button {
      background-color: #00bcd4;
      color: white;
      cursor: pointer;
    }
    .hidden { display: none; }
    .game-card {
      background: #333;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
    }
    .game-card img {
      width: 100%;
      border-radius: 5px;
    }
  </style>
</head>
<body>

<div class="container" id="catalogContainer">
  <h2>Oyun Listesi</h2>
  <div id="gameList"></div>
  <div id="cartContainer"></div>
</div>

<script>
  const exampleGames = [
    {
      name: "GTA San Andreas",
      device: "PlayStation",
      model: "PlayStation 2",
      image: "https://i.imgur.com/J1mzy5F.jpeg",
      video: "https://www.youtube.com/watch?v=hvoD7ehZPcM",
      price: 50
    },
    {
      name: "Halo",
      device: "XBOX",
      model: "XBOX Classic",
      image: "https://i.imgur.com/W1fZ5hf.jpeg",
      video: "https://www.youtube.com/watch?v=L0X4Lxw5fHY",
      price: 70
    }
  ];

  let cart = JSON.parse(localStorage.getItem("akme_cart") || "[]");

  function saveCart() {
    localStorage.setItem("akme_cart", JSON.stringify(cart));
  }

  function addToCart(game) {
    if (!cart.find(g => g.name === game.name)) {
      cart.push(game);
      saveCart();
    }
    updateCartDisplay();
  }

  function removeFromCart(name) {
    cart = cart.filter(g => g.name !== name);
    saveCart();
    updateCartDisplay();
  }

  function updateCartDisplay() {
    const cartContainer = document.getElementById("cartContainer");
    cartContainer.innerHTML = "<h3>Sepetim</h3>";
    let total = 0;
    cart.forEach(game => {
      total += Number(game.price);
      cartContainer.innerHTML += `
        <div class="game-card">
          <h4>${game.name}</h4>
          <p>${game.device} - ${game.model}</p>
          <strong>Fiyat: ${game.price} TL</strong><br>
          <button onclick="removeFromCart('${game.name}')">Sepetten Çıkar</button>
        </div>
      `;
    });
    if (cart.length > 0) {
      cartContainer.innerHTML += `<h4>Toplam: ${total} TL</h4>
      <button onclick="sendCartViaWhatsApp()">WhatsApp'tan Gönder</button>`;
    }
  }

  function openVideo(link) {
    const win = window.open();
    win.document.write(\`
      <title>Oyun Videosu</title>
      <body style="margin:0">
        <iframe width="100%" height="100%" src="\${link.replace('watch?v=', 'embed/')}" frameborder="0" allowfullscreen></iframe>
      </body>
    \`);
  }

  function sendCartViaWhatsApp() {
    const name = "Mehmet Taşdemir"; // Firebase'den alınacak yer
    let message = \`Merhaba, ben \${name}. Sepetimdeki oyunlar:

\`;
    let total = 0;
    cart.forEach(game => {
      message += \`- \${game.name} (\${game.device} - \${game.model}) - \${game.price} TL
\`;
      total += Number(game.price);
    });
    message += \`
Toplam Tutar: \${total} TL\`;
    const url = "https://wa.me/905548801010?text=" + encodeURIComponent(message);
    window.open(url, "_blank");
  }

  function loadGames() {
    const container = document.getElementById("gameList");
    exampleGames.forEach(game => {
      const card = document.createElement("div");
      card.className = "game-card";
      card.innerHTML = \`
        <h4>\${game.name}</h4>
        <img src="\${game.image}" alt="\${game.name}">
        <p>\${game.device} - \${game.model}</p>
        <strong>Fiyat: \${game.price} TL</strong><br>
        <button onclick='addToCart(\${JSON.stringify(game)})'>Sepete Ekle</button>
        <button onclick='openVideo("\${game.video}")'>Video İzle</button>
      \`;
      container.appendChild(card);
    });
  }

  window.onload = () => {
    loadGames();
    updateCartDisplay();
  };
</script>
</body>
</html>
