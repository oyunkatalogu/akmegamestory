
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AKME GAME - Tam Sistem</title>
  <style>
    body {
      background: linear-gradient(to right, #1f1f2f, #12121a);
      font-family: 'Segoe UI', sans-serif;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
    }
    .container {
      background-color: #2a2a3a;
      padding: 20px;
      border-radius: 10px;
      width: 320px;
      margin: 20px 0;
    }
    input, button, select {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border: none;
      border-radius: 5px;
    }
    button {
      background-color: #00bcd4;
      color: white;
      cursor: pointer;
    }
    .hidden { display: none; }
    .game-card {
      background: #333;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
    }
    .game-card img {
      width: 100%;
      border-radius: 5px;
    }
  </style>
</head>
<body>
<div class="container" id="loginContainer">
  <h2>Giriş Yap</h2>
  <input type="text" id="loginUsername" placeholder="Kullanıcı Adı">
  <input type="password" id="loginPassword" placeholder="Şifre">
  <label><input type="checkbox" id="rememberMe"> Beni Hatırla</label>
  <button onclick="login()">Giriş Yap</button>
  <button onclick="showRegister()">Kayıt Ol</button>
  <button onclick="showReset()">Şifremi Unuttum</button>
</div>

<div class="container hidden" id="registerContainer">
  <h2>Kayıt Ol</h2>
  <input type="text" id="regUsername" placeholder="Kullanıcı Adı">
  <input type="text" id="regAd" placeholder="Ad">
  <input type="text" id="regSoyad" placeholder="Soyad">
  <input type="email" id="regMail" placeholder="Mail Adresi">
  <input type="tel" id="regTel" placeholder="Telefon Numarası">
  <input type="password" id="regPass" placeholder="Parola">
  <input type="password" id="regPassRepeat" placeholder="Parola Tekrarı">
  <button onclick="register()">Gönder</button>
  <button onclick="showLogin()">Geri</button>
</div>

<div class="container hidden" id="resetContainer">
  <h2>Şifre Sıfırla</h2>
  <input type="email" id="resetMail" placeholder="Kayıtlı Mail Adresi">
  <button onclick="resetPassword()">Sıfırlama Linki Gönder</button>
  <button onclick="showLogin()">Geri</button>
</div>

<div class="container hidden" id="mainContainer">
  <h2>AKME GAME</h2>
  <p id="welcomeText"></p>
  <button onclick="goCatalog()">Kataloğa Git</button>
  <button onclick="logout()">ÇIKIŞ YAP</button>
</div>

<div class="container hidden" id="catalogContainer">
  <h2>Oyun Ara</h2>
  <input type="text" id="searchInput" placeholder="Oyun adı girin...">
  <button onclick="searchGames()">Ara</button>

  <h3>Cihaz/Model ile Filtrele</h3>
  <select id="deviceSelect">
    <option value="">Cihaz Seç</option>
    <option value="PlayStation">PlayStation</option>
    <option value="XBOX">XBOX</option>
    <option value="Sega">Sega</option>
  </select>
  <select id="modelSelect">
    <option value="">Model Seç</option>
    <option value="PlayStation 1">PlayStation 1</option>
    <option value="PlayStation 2">PlayStation 2</option>
    <option value="PlayStation 3">PlayStation 3</option>
    <option value="XBOX Classic">XBOX Classic</option>
    <option value="Sega Mega Drive">Sega Mega Drive</option>
  </select>
  <button onclick="loadGames()">Göster</button>

  <div id="gameList" style="margin-top: 15px;"></div>
  <button onclick="showMain()">Geri</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
<script>
  let cart = [];

  function toggleCart(gameId, game) {
    const index = cart.findIndex(item => item.id === gameId);
    if (index === -1) {
      cart.push({ id: gameId, ...game });
    } else {
      cart.splice(index, 1);
    }
    updateCartButton(gameId);
  }

  function updateCartButton(gameId) {
    const button = document.getElementById("cart-btn-" + gameId);
    if (!button) return;
    const inCart = cart.find(item => item.id === gameId);
    button.textContent = inCart ? "Sepetten Çıkar" : "Sepete Ekle";
  }

  function sendCartToWhatsApp() {
    if (cart.length === 0) {
      alert("Sepetiniz boş.");
      return;
    }
    let message = "Sipariş Listesi:%0A";
    let total = 0;
    cart.forEach((item, i) => {
      message += `${i + 1}. ${item.name} - ${item.price} TL%0A`;
      total += parseFloat(item.price);
    });
    message += `%0AToplam: ${total} TL`;
    const phone = "905548801010";
    window.open(`https://wa.me/${phone}?text=${message}`, "_blank");
  }

  async function loadGames() {
    const selectedDevice = document.getElementById("deviceSelect").value;
    const selectedModel = document.getElementById("modelSelect").value;
    const container = document.getElementById("gameList");
    container.innerHTML = "";

    const snapshot = await db.ref("games").once("value");
    snapshot.forEach(child => {
      const game = child.val();
      const gameId = child.key;
      if (game.device === selectedDevice && game.model === selectedModel) {
        const card = document.createElement("div");
        card.className = "game-card";
        card.innerHTML = `
          <h4>${game.name}</h4>
          <img src="${game.image}" alt="${game.name}">
          <p>${game.description}</p>
          <strong>${game.device} - ${game.model}</strong><br>
          <strong>Fiyat: ${game.price} TL</strong><br>
          <button id="cart-btn-${gameId}" onclick='toggleCart("${gameId}", ${JSON.stringify(game)})'>Sepete Ekle</button>
        `;
        container.appendChild(card);
        updateCartButton(gameId);
      }
    });

    const sendButton = document.createElement("button");
    sendButton.textContent = "WhatsApp'tan Sipariş Gönder";
    sendButton.onclick = sendCartToWhatsApp;
    sendButton.style.marginTop = "10px";
    container.appendChild(sendButton);
  }

  async function searchGames() {
    const term = document.getElementById("searchInput").value.toLowerCase();
    const container = document.getElementById("gameList");
    container.innerHTML = "";
    let found = false;

    const snapshot = await db.ref("games").once("value");
    snapshot.forEach(child => {
      const game = child.val();
      const gameId = child.key;
      if (game.name && game.name.toLowerCase().includes(term)) {
        const card = document.createElement("div");
        card.className = "game-card";
        card.innerHTML = `
          <h4>${game.name}</h4>
          <img src="${game.image}" alt="${game.name}">
          <p>${game.description}</p>
          <strong>${game.device} - ${game.model}</strong><br>
          <strong>Fiyat: ${game.price} TL</strong><br>
          <button id="cart-btn-${gameId}" onclick='toggleCart("${gameId}", ${JSON.stringify(game)})'>Sepete Ekle</button>
        `;
        container.appendChild(card);
        updateCartButton(gameId);
        found = true;
      }
    });

    if (!found) {
      container.innerHTML = "<p>Oyun bulunamadı.</p>";
    } else {
      const sendButton = document.createElement("button");
      sendButton.textContent = "WhatsApp'tan Sipariş Gönder";
      sendButton.onclick = sendCartToWhatsApp;
      sendButton.style.marginTop = "10px";
      container.appendChild(sendButton);
    }
  }
</script>

</body>
</html>
